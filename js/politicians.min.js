(()=>{(function(){const i=document.getElementById("politician-search"),l=document.getElementById("politician-list"),c=document.getElementById("filter-level"),t=document.getElementById("filter-country"),d=document.getElementById("filter-xstatus"),n=document.getElementById("politician-stats");if(!l||!i||!d||!n){console.warn("Required elements not found (list/search/status/stats).");return}const _=window.PAGE_TITLE?window.PAGE_TITLE.replace(/^["“]|["”]$/g,""):"",u=!!c,f=!!t,r=window.POLITICIANS||[];let e=[];if(Array.isArray(r))e=r;else if(typeof r=="string")try{const t=JSON.parse(r);Array.isArray(t)&&(e=t)}catch(e){console.warn("Failed to parse POLITICIANS JSON string:",e)}function a(e){const t=(e.xStatus||"").toLowerCase();return t==="active"||t==="inactive"||t==="none"||t==="unknown"?t:e.usesX===!0?"active":e.usesX===!1?"none":"unknown"}function y(e){const t=a(e);return t==="inactive"?"x-inactive":t==="active"?"x-active":t==="none"?"x-none":"x-unknown"}function g(e,t){if(!t)return!0;const n=a(e);return t==="active"||t==="inactive"||t==="none"?n===t:t==="on"?n==="active":t!=="off"||n==="none"}function p(e){const t=a(e),o=e.xHandle?` (${e.xHandle})`:"";let n="Status unknown";t==="active"?n="Still active on X":t==="inactive"?n="Has X, but is inactive":t==="none"&&(n="Not on X"),t==="inactive"&&e.xLastArchiveUrl&&(n+=` - <a href="${e.xLastArchiveUrl}" class="link-primary" target="_blank" rel="noopener noreferrer">see exit post</a>`);const i=e.xHandle&&(t==="active"||t==="inactive")?`<a href="https://x.com/${e.xHandle.replace("@","")}" class="link-primary" target="_blank" rel="noopener noreferrer">${e.xHandle}</a>`:"",s=i||o;return`
      <li>
        <strong>X status:</strong> ${n}
        ${s?` ${s}`:""}
      </li>
    `}const s=new Map;if(e.forEach(e=>{e.countryCode&&e.country?s.set(e.countryCode,e.country):e.country&&s.set(e.country,e.country)}),t){const e=Array.from(s.entries()).sort((e,t)=>e[1].localeCompare(t[1],0[0],{sensitivity:"base"}));e.forEach(([e,n])=>{const s=document.createElement("option");s.value=e,s.textContent=n,t.appendChild(s)})}function m(e,t){if(!n)return;const o=e.length;if(o===0){n.innerHTML='<p class="politician-stats-text">No politicians match the current filters.</p>';return}let r=0,c=0,l=0,d=0;e.forEach(e=>{const t=a(e);t==="active"?r+=1:t==="inactive"?c+=1:t==="none"?l+=1:d+=1});const u=r+c,p=l,h=Math.round(u/o*100),m=f({searchTerm:i.value.trim(),countryValue:t});function f({searchTerm:e,countryValue:t}){if(e)return`Search results for “${e}”`;if(t){const e=s.get(t);return`${e||t} MEPs`}return window.PAGE_TITLE?_:"All countries"}n.innerHTML=`
      <div class="stats-card" role="region" aria-label="X account statistics">
        <div class="stats-title">${m} on X</div>

        <div class="stats-bar-info">
          <div class="stats-percentage">${h}%</div>
          <div class="stats-total">${u} of ${o} MPs still have an X account</div>
        </div>

        <div class="stats-bar" aria-hidden="true">
          <div class="stats-bar-fill" style="width:${h}%"></div>
        </div>

        <div class="stats-boxes">
          <div class="stats-box active">
            <div class="stats-box-number">${r}</div>
            <div class="stats-box-label">Active on X</div>
          </div>

          <div class="stats-box inactive">
            <div class="stats-box-number">${c}</div>
            <div class="stats-box-label">Inactive on X</div>
          </div>

          <div class="stats-box not-on">
            <div class="stats-box-number">${l}</div>
            <div class="stats-box-label">Not on X</div>
          </div>

          ${d?`
            <div class="stats-box unknown">
              <div class="stats-box-number">${d}</div>
              <div class="stats-box-label">Unknown</div>
            </div>
          `:""}
        </div>
      </div>
    `}function v(e,t){if(!t)return!0;const n=t.toLowerCase(),s=[e.name,e.country,e.level,e.institution,e.role,e.party,e.xHandle,e.email];return s.filter(Boolean).some(e=>String(e).toLowerCase().includes(n))}function b(e,t){return!t||(e.level||"").toLowerCase()===t.toLowerCase()}function j(e,t){if(!t)return!0;const n=(e.countryCode||e.country||"").toString().toLowerCase();return n===t.toLowerCase()}function h(e){if(!e.length){l.innerHTML="<p>No politicians match your filters.</p>";return}const t=e.map(e=>{const t=e.country||e.countryCode||"",n=e.level==="eu"?"EU level":e.level==="national"?"National":e.level||"",s=y(e);return`
          <article class="politician-card ${s}">
            <h2>${e.name}</h2>
            <ul>
              ${t?`<li><strong>Country:</strong> ${t}</li>`:""}
              ${n?`<li><strong>Level:</strong> ${n}</li>`:""}
              ${e.institution?`<li><strong>Institution:</strong> ${e.institution}</li>`:""}
              ${e.role?`<li><strong>Role:</strong> ${e.role}</li>`:""}
              ${e.party?`<li><strong>Party:</strong> ${e.party}</li>`:""}
              ${e.email?`<li><strong>Email:</strong> <a href="mailto:${e.email}" class="link-primary">${e.email}</a></li>`:""}
              ${p(e)}
            </ul>
          </article>
        `}).join("");l.innerHTML=t}function o(){const o=i.value.trim(),a=u?c.value:"",n=f?t.value:"",r=d.value,s=e.filter(e=>v(e,o)&&b(e,a)&&j(e,n)&&g(e,r));h(s),m(s,n)}h(e),m(e,""),i.addEventListener("input",o),d.addEventListener("change",o),u&&c.addEventListener("change",o),f&&t.addEventListener("change",o)})()})()