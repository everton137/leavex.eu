(()=>{(function(){const d=document.getElementById("politician-search"),l=document.getElementById("politician-list"),c=document.getElementById("filter-level"),t=document.getElementById("filter-country"),r=document.getElementById("filter-xstatus"),o=document.getElementById("politician-stats");if(!l||!d||!r||!o){console.warn("Required elements not found (list/search/status/stats).");return}const f=!!c,h=!!t,a=window.POLITICIANS||[];let e=[];if(Array.isArray(a))e=a;else if(typeof a=="string")try{const t=JSON.parse(a);Array.isArray(t)&&(e=t)}catch(e){console.warn("Failed to parse POLITICIANS JSON string:",e)}function n(e){const t=(e.xStatus||"").toLowerCase();return t==="active"||t==="inactive"||t==="none"||t==="unknown"?t:e.usesX===!0?"active":e.usesX===!1?"none":"unknown"}function v(e){const t=n(e);return t==="inactive"?"x-inactive":t==="active"?"x-active":t==="none"?"x-none":"x-unknown"}function p(e,t){if(!t)return!0;const s=n(e);return t==="active"||t==="inactive"||t==="none"?s===t:t==="on"?s==="active":t!=="off"||s==="none"}function g(e){const t=n(e),i=e.xHandle?` (${e.xHandle})`:"";let s="Status unknown";t==="active"?s="Still active on X":t==="inactive"?s="Has X, but is inactive":t==="none"&&(s="Not on X"),t==="inactive"&&e.xLastArchiveUrl&&(s+=` - <a href="${e.xLastArchiveUrl}" target="_blank" rel="noopener noreferrer">see exit post</a>`);const a=e.xHandle&&(t==="active"||t==="inactive")?`<a href="https://x.com/${e.xHandle.replace("@","")}" target="_blank" rel="noopener noreferrer">${e.xHandle}</a>`:"",o=a||i;return`
      <li>
        <strong>X status:</strong> ${s}
        ${o?` ${o}`:""}
      </li>
    `}const s=new Map;if(e.forEach(e=>{e.countryCode&&e.country?s.set(e.countryCode,e.country):e.country&&s.set(e.country,e.country)}),t){const e=Array.from(s.entries()).sort((e,t)=>e[1].localeCompare(t[1],0[0],{sensitivity:"base"}));e.forEach(([e,n])=>{const s=document.createElement("option");s.value=e,s.textContent=n,t.appendChild(s)})}function u(e,t){if(!o)return;const i=e.length;if(i===0){o.innerHTML='<p class="politician-stats-text">No politicians match the current filters.</p>';return}let a=0,r=0,c=0,l=0;e.forEach(e=>{const t=n(e);t==="active"?a+=1:t==="inactive"?r+=1:t==="none"?c+=1:l+=1});const d=a+r,f=c,h=Math.round(d/i*100);let u="All countries";if(t){const e=s.get(t);u=e||t}const m=t?`${u}: `:"";o.innerHTML=`
      <p class="politician-stats-summary">
        ${m}<strong>${i} MPs analysed</strong>
      </p>

      <p class="politician-stats-breakdown">
        <strong>Still active on X:</strong> ${a} \xB7
        <strong>Inactive but on X:</strong> ${r} \xB7
        <strong>Not on X:</strong> ${c}
        ${l?` \xB7 <strong>Unknown:</strong> ${l}`:""}
      </p>

      <p class="politician-stats-highlight">
        <strong>${h}%</strong> (${d}/${i}) still have an X account
      </p>
    `}function b(e,t){if(!t)return!0;const n=t.toLowerCase(),s=[e.name,e.country,e.level,e.institution,e.role,e.party,e.xHandle,e.email];return s.filter(Boolean).some(e=>String(e).toLowerCase().includes(n))}function j(e,t){return!t||(e.level||"").toLowerCase()===t.toLowerCase()}function y(e,t){if(!t)return!0;const n=(e.countryCode||e.country||"").toString().toLowerCase();return n===t.toLowerCase()}function m(e){if(!e.length){l.innerHTML="<p>No politicians match your filters.</p>";return}const t=e.map(e=>{const t=e.country||e.countryCode||"",n=e.level==="eu"?"EU level":e.level==="national"?"National":e.level||"",s=v(e);return`
          <article class="politician-card ${s}">
            <h2>${e.name}</h2>
            <ul>
              ${t?`<li><strong>Country:</strong> ${t}</li>`:""}
              ${n?`<li><strong>Level:</strong> ${n}</li>`:""}
              ${e.institution?`<li><strong>Institution:</strong> ${e.institution}</li>`:""}
              ${e.role?`<li><strong>Role:</strong> ${e.role}</li>`:""}
              ${e.party?`<li><strong>Party:</strong> ${e.party}</li>`:""}
              ${e.email?`<li><strong>Email:</strong> <a href="mailto:${e.email}">${e.email}</a></li>`:""}
              ${g(e)}
            </ul>
          </article>
        `}).join("");l.innerHTML=t}function i(){const o=d.value.trim(),i=f?c.value:"",n=h?t.value:"",a=r.value,s=e.filter(e=>b(e,o)&&j(e,i)&&y(e,n)&&p(e,a));m(s),u(s,n)}m(e),u(e,""),d.addEventListener("input",i),r.addEventListener("change",i),f&&c.addEventListener("change",i),h&&t.addEventListener("change",i)})()})()