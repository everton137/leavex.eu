(()=>{console.log("search.js loaded"),function(){const r=document.getElementById("politician-search"),l=document.getElementById("politician-list"),c=document.getElementById("filter-level"),o=document.getElementById("filter-country"),a=document.getElementById("filter-xstatus"),i=document.getElementById("politician-stats");if(!l||!r||!c||!o||!a||!i){console.warn("One or more filter elements not found.");return}const t=window.POLITICIANS||[];let e=[];if(Array.isArray(t))e=t;else if(typeof t=="string")try{const n=JSON.parse(t);Array.isArray(n)&&(e=n)}catch(e){console.warn("Failed to parse POLITICIANS JSON string:",e)}const s=new Map;e.forEach(e=>{e.countryCode&&e.country?s.set(e.countryCode,e.country):e.country&&s.set(e.country,e.country)});const h=Array.from(s.entries()).sort((e,t)=>e[1].localeCompare(t[1],0[0],{sensitivity:"base"}));h.forEach(([e,t])=>{const n=document.createElement("option");n.value=e,n.textContent=t,o.appendChild(n)});function m(e,t){if(!t)return!0;const n=!!e.usesX;return t==="on"?n===!0:t!=="off"||n===!1}function d(e,t){if(!i)return;const o=e.length;if(o===0){i.innerHTML='<p class="politician-stats-text">No politicians match the current filters.</p>';return}let a=0,n=0;e.forEach(e=>{e.usesX?a+=1:n+=1});const c=Math.round(n/o*100);let r="All countries";if(t){const e=s.get(t);r=e||t}const l=!!t,d=l?`${r}: `:"";i.innerHTML=`
    <p class="politician-stats-text">
      ${d}
      <strong>Still on X:</strong> ${a} /
      <strong>Not on X:</strong> ${n}
      <span class="politician-stats-percent">(${c}% not on X)</span>
    </p>
  `}function f(e,t){if(!t)return!0;const n=t.toLowerCase(),s=[e.name,e.country,e.level,e.institution,e.role,e.party,e.xHandle,e.email];return s.filter(Boolean).some(e=>String(e).toLowerCase().includes(n))}function p(e,t){return!t||(e.level||"").toLowerCase()===t.toLowerCase()}function g(e,t){if(!t)return!0;const n=(e.countryCode||e.country||"").toString().toLowerCase();return n===t.toLowerCase()}function u(e){if(!e.length){l.innerHTML="<p>No politicians match your filters.</p>";return}const t=e.map(e=>{const s=e.usesX?`Yes (${e.xHandle||"no handle"})`:"No",t=e.country||e.countryCode||"",n=e.level==="eu"?"EU level":e.level==="national"?"National":e.level||"";return`
        <article class="politician-card ${e.usesX?"on-x":"not-on-x"}">
          <h2>${e.name}</h2>
          <ul>
            ${t?`<li><strong>Country:</strong> ${t}</li>`:""}
            ${n?`<li><strong>Level:</strong> ${n}</li>`:""}
            ${e.institution?`<li><strong>Institution:</strong> ${e.institution}</li>`:""}
            ${e.role?`<li><strong>Role:</strong> ${e.role}</li>`:""}
            ${e.party?`<li><strong>Party:</strong> ${e.party}</li>`:""}
            ${e.email?`<li><strong>Email:</strong> <a href="mailto:${e.email}">${e.email}</a></li>`:""}
            <li><strong>On X/Twitter:</strong> ${s}</li>
          </ul>
        </article>
      `}).join("");l.innerHTML=t}function n(){const s=r.value.trim(),i=c.value,t=o.value,l=a.value,n=e.filter(e=>f(e,s)&&p(e,i)&&g(e,t)&&m(e,l));u(n),d(n,t)}u(e),d(e,""),r.addEventListener("input",n),c.addEventListener("change",n),o.addEventListener("change",n),a.addEventListener("change",n)}()})()