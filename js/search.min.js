(()=>{console.log("search.js loaded"),function(){const a=document.getElementById("politician-search"),i=document.getElementById("politician-list"),o=document.getElementById("filter-level"),n=document.getElementById("filter-country");if(!i||!a||!o||!n){console.warn("One or more filter elements not found.");return}const t=window.POLITICIANS||[];let e=[];if(Array.isArray(t))e=t;else if(typeof t=="string")try{const n=JSON.parse(t);Array.isArray(n)&&(e=n)}catch(e){console.warn("Failed to parse POLITICIANS JSON string:",e)}console.log(t),console.log("Loaded politicians:",e.length,e);const s=new Map;e.forEach(e=>{e.countryCode&&e.country?s.set(e.countryCode,e.country):e.country&&s.set(e.country,e.country)});const l=Array.from(s.entries()).sort((e,t)=>e[1].localeCompare(t[1],0[0],{sensitivity:"base"}));l.forEach(([e,t])=>{const s=document.createElement("option");s.value=e,s.textContent=t,n.appendChild(s)});function d(e,t){if(!t)return!0;const n=t.toLowerCase(),s=[e.name,e.country,e.level,e.institution,e.role,e.party,e.xHandle,e.email];return s.filter(Boolean).some(e=>String(e).toLowerCase().includes(n))}function u(e,t){return!t||(e.level||"").toLowerCase()===t.toLowerCase()}function h(e,t){if(!t)return!0;const n=(e.countryCode||e.country||"").toString().toLowerCase();return n===t.toLowerCase()}function c(e){if(!e.length){i.innerHTML="<p>No politicians match your filters.</p>";return}const t=e.map(e=>{const s=e.usesX?`Yes (${e.xHandle||"no handle"})`:"No",t=e.country||e.countryCode||"",n=e.level==="eu"?"EU level":e.level==="national"?"National":e.level||"";return`
        <article class="politician-card ${e.usesX?"on-x":"not-on-x"}">
          <h2>${e.name}</h2>
          <ul>
            ${t?`<li><strong>Country:</strong> ${t}</li>`:""}
            ${n?`<li><strong>Level:</strong> ${n}</li>`:""}
            ${e.institution?`<li><strong>Institution:</strong> ${e.institution}</li>`:""}
            ${e.role?`<li><strong>Role:</strong> ${e.role}</li>`:""}
            ${e.party?`<li><strong>Party:</strong> ${e.party}</li>`:""}
            ${e.email?`<li><strong>Email:</strong> <a href="mailto:${e.email}">${e.email}</a></li>`:""}
            <li><strong>On X/Twitter:</strong> ${s}</li>
          </ul>
        </article>
      `}).join("");i.innerHTML=t}function r(){const t=a.value.trim(),s=o.value,i=n.value,r=e.filter(e=>d(e,t)&&u(e,s)&&h(e,i));c(r)}c(e),a.addEventListener("input",r),o.addEventListener("change",r),n.addEventListener("change",r)}()})()