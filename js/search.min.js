(()=>{(function(){const d=document.getElementById("politician-search"),l=document.getElementById("politician-list"),r=document.getElementById("filter-level"),n=document.getElementById("filter-country"),c=document.getElementById("filter-xstatus"),s=document.getElementById("politician-stats");if(!l||!d||!r||!n||!c||!s){console.warn("One or more filter elements not found.");return}const t=window.POLITICIANS||[];let e=[];if(Array.isArray(t))e=t;else if(typeof t=="string")try{const n=JSON.parse(t);Array.isArray(n)&&(e=n)}catch(e){console.warn("Failed to parse POLITICIANS JSON string:",e)}function o(e){const t=(e.xStatus||"").toLowerCase();return t==="active"||t==="inactive"||t==="none"||t==="unknown"?t:e.usesX===!0?"active":e.usesX===!1?"none":"unknown"}function j(e){const t=o(e);return t==="inactive"?"x-inactive":t==="active"?"x-active":t==="none"?"x-none":"x-unknown"}function m(e,t){if(!t)return!0;const n=o(e);return t==="active"||t==="inactive"||t==="none"?n===t:t==="on"?n==="active":t!=="off"||n==="none"}function b(e){const t=o(e),i=e.xHandle?` (${e.xHandle})`:"";let n="Status unknown";t==="active"?n="Still active on X":t==="inactive"?n="Has X, but is inactive":t==="none"&&(n="Not on X"),t==="inactive"&&e.xLastArchiveUrl&&(n+=` - <a href="${e.xLastArchiveUrl}" target="_blank" rel="noopener noreferrer">see exit post</a>`);const a=e.xHandle&&(t==="active"||t==="inactive")?`<a href="https://x.com/${e.xHandle.replace("@","")}" target="_blank" rel="noopener noreferrer">${e.xHandle}</a>`:"",s=a||i;return`
      <li>
        <strong>X status:</strong> ${n}
        ${s?` ${s}`:""}
      </li>
    `}const a=new Map;e.forEach(e=>{e.countryCode&&e.country?a.set(e.countryCode,e.country):e.country&&a.set(e.country,e.country)});const f=Array.from(a.entries()).sort((e,t)=>e[1].localeCompare(t[1],0[0],{sensitivity:"base"}));f.forEach(([e,t])=>{const s=document.createElement("option");s.value=e,s.textContent=t,n.appendChild(s)});function u(e,t){if(!s)return;const l=e.length;if(l===0){s.innerHTML='<p class="politician-stats-text">No politicians match the current filters.</p>';return}let n=0,i=0,r=0,c=0;e.forEach(e=>{const t=o(e);t==="active"?n+=1:t==="inactive"?i+=1:t==="none"?r+=1:c+=1});const u=n+i,f=r,h=Math.round(u/l*100);let d="All countries";if(t){const e=a.get(t);d=e||t}const m=t?`${d}: `:"";s.innerHTML=`
      <p class="politician-stats-text">
        ${m}
        <strong>Still active on X:</strong> ${n} /
        <strong>Inactive but on X:</strong> ${i} /
        <strong>Not on X:</strong> ${r}
        ${c?`/ <strong>Unknown:</strong> ${c}`:""}
        <span class="politician-stats-percent">
          (${h}% <strong><em>still have an X account</em></strong>)
        </span>
      </p>
    `}function p(e,t){if(!t)return!0;const n=t.toLowerCase(),s=[e.name,e.country,e.level,e.institution,e.role,e.party,e.xHandle,e.email];return s.filter(Boolean).some(e=>String(e).toLowerCase().includes(n))}function g(e,t){return!t||(e.level||"").toLowerCase()===t.toLowerCase()}function v(e,t){if(!t)return!0;const n=(e.countryCode||e.country||"").toString().toLowerCase();return n===t.toLowerCase()}function h(e){if(!e.length){l.innerHTML="<p>No politicians match your filters.</p>";return}const t=e.map(e=>{const t=e.country||e.countryCode||"",n=e.level==="eu"?"EU level":e.level==="national"?"National":e.level||"",s=j(e);return`
          <article class="politician-card ${s}">
            <h2>${e.name}</h2>
            <ul>
              ${t?`<li><strong>Country:</strong> ${t}</li>`:""}
              ${n?`<li><strong>Level:</strong> ${n}</li>`:""}
              ${e.institution?`<li><strong>Institution:</strong> ${e.institution}</li>`:""}
              ${e.role?`<li><strong>Role:</strong> ${e.role}</li>`:""}
              ${e.party?`<li><strong>Party:</strong> ${e.party}</li>`:""}
              ${e.email?`<li><strong>Email:</strong> <a href="mailto:${e.email}">${e.email}</a></li>`:""}
              ${b(e)}
            </ul>
          </article>
        `}).join("");l.innerHTML=t}function i(){const o=d.value.trim(),i=r.value,t=n.value,a=c.value,s=e.filter(e=>p(e,o)&&g(e,i)&&v(e,t)&&m(e,a));h(s),u(s,t)}h(e),u(e,""),d.addEventListener("input",i),r.addEventListener("change",i),n.addEventListener("change",i),c.addEventListener("change",i)})()})()