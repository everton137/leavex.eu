(()=>{console.log("search.js loaded"),function(){const o=document.getElementById("politician-search"),a=document.getElementById("politician-list"),c=document.getElementById("filter-level"),t=document.getElementById("filter-country"),i=document.getElementById("filter-xstatus");if(!a||!o||!c||!t||!i){console.warn("One or more filter elements not found.");return}const n=window.POLITICIANS||[];let e=[];if(Array.isArray(n))e=n;else if(typeof n=="string")try{const t=JSON.parse(n);Array.isArray(t)&&(e=t)}catch(e){console.warn("Failed to parse POLITICIANS JSON string:",e)}const r=new Map;e.forEach(e=>{e.countryCode&&e.country?r.set(e.countryCode,e.country):e.country&&r.set(e.country,e.country)});const d=Array.from(r.entries()).sort((e,t)=>e[1].localeCompare(t[1],0[0],{sensitivity:"base"}));d.forEach(([e,n])=>{const s=document.createElement("option");s.value=e,s.textContent=n,t.appendChild(s)});function f(e,t){if(!t)return!0;const n=!!e.usesX;return t==="on"?n===!0:t!=="off"||n===!1}function m(e,t){if(!t)return!0;const n=t.toLowerCase(),s=[e.name,e.country,e.level,e.institution,e.role,e.party,e.xHandle,e.email];return s.filter(Boolean).some(e=>String(e).toLowerCase().includes(n))}function u(e,t){return!t||(e.level||"").toLowerCase()===t.toLowerCase()}function h(e,t){if(!t)return!0;const n=(e.countryCode||e.country||"").toString().toLowerCase();return n===t.toLowerCase()}function l(e){if(!e.length){a.innerHTML="<p>No politicians match your filters.</p>";return}const t=e.map(e=>{const s=e.usesX?`Yes (${e.xHandle||"no handle"})`:"No",t=e.country||e.countryCode||"",n=e.level==="eu"?"EU level":e.level==="national"?"National":e.level||"";return`
        <article class="politician-card ${e.usesX?"on-x":"not-on-x"}">
          <h2>${e.name}</h2>
          <ul>
            ${t?`<li><strong>Country:</strong> ${t}</li>`:""}
            ${n?`<li><strong>Level:</strong> ${n}</li>`:""}
            ${e.institution?`<li><strong>Institution:</strong> ${e.institution}</li>`:""}
            ${e.role?`<li><strong>Role:</strong> ${e.role}</li>`:""}
            ${e.party?`<li><strong>Party:</strong> ${e.party}</li>`:""}
            ${e.email?`<li><strong>Email:</strong> <a href="mailto:${e.email}">${e.email}</a></li>`:""}
            <li><strong>On X/Twitter:</strong> ${s}</li>
          </ul>
        </article>
      `}).join("");a.innerHTML=t}function s(){const n=o.value.trim(),s=c.value,a=t.value,r=i.value,d=e.filter(e=>m(e,n)&&u(e,s)&&h(e,a)&&f(e,r));l(d)}l(e),o.addEventListener("input",s),c.addEventListener("change",s),t.addEventListener("change",s),i.addEventListener("change",s)}()})()